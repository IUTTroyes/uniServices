// Copyright (c) 2020. | David Annebicque | IUT de Troyes  - All Rights Reserved
// @file /Users/davidannebicque/htdocs/intranetV3/assets/vendor/jquery.collection.min.js
// @author davidannebicque
// @project intranetV3
// @lastUpdate 17/08/2020 14:20

!function(e){e.fn.collection=function(t){var n={container:"body",allow_up:!0,up:'<a href="#">&#x25B2;</a>',before_up:function(e,t){return!0},after_up:function(e,t){return!0},allow_down:!0,down:'<a href="#">&#x25BC;</a>',before_down:function(e,t){return!0},after_down:function(e,t){return!0},allow_add:!0,add:'<a href="#">[ + ]</a>',before_add:function(e,t){return!0},after_add:function(e,t){return!0},allow_remove:!0,remove:'<a href="#">[ - ]</a>',before_remove:function(e,t){return!0},after_remove:function(e,t){return!0},allow_duplicate:!1,duplicate:'<a href="#">[ # ]</a>',before_duplicate:function(e,t){return!0},after_duplicate:function(e,t){return!0},before_init:function(e){},after_init:function(e){},min:0,max:100,add_at_the_end:!1,prefix:"collection",prototype_name:"__name__",name_prefix:null,elements_selector:"> div, > fieldset",elements_parent_selector:"%id%",children:null,init_with_n_elements:0,hide_useless_buttons:!0,drag_drop:!0,drag_drop_options:{placeholder:"ui-state-highlight"},drag_drop_start:function(e,t){return!0},drag_drop_update:function(e,t){return!0},custom_add_location:!1,action_container_tag:"div",fade_in:!0,fade_out:!0,position_field_selector:null,preserve_names:!1},i=function(t,n){if(!n.attr("id")){var i;do{i=t+"_"+(""+1e3*Math.random()*(new Date).getTime()).replace(".","").split("").sort(function(){return.5-Math.random()}).join("")}while(e("#"+i).length>0);n.attr("id",i)}return n.attr("id")},o=function(t){try{var n=e(t)}catch(e){return null}return 0===n.length?null:n.is('input[type="checkbox"]')?!0===n.prop("checked"):n.is('input[type="radio"]')&&void 0!==n.attr("name")?e('input[name="'+n.attr("name")+'"]:checked').val():void 0!==n.prop("value")?n.val():n.html()},a=function(t,n,i){try{var o=e(t)}catch(e){return}0!==o.length&&(o.is('input[type="checkbox"]')?n?o.attr("checked",!0):o.removeAttr("checked"):void 0!==o.prop("value")?i?o.attr("value",n):o.val(n):o.html(n))},r=function(e){return void 0===e||e},l=function(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")},d=function(t,n,i,o){var a=function(t){var n=e(t);"object"==typeof t&&"attributes"in t&&e.each(t.attributes,function(t,a){"string"===e.type(a.value)&&n.attr(a.name.replace(i,o),a.value.replace(i,o))}),n.length>0&&e.each(n.data(),function(t,a){"string"===e.type(a)&&n.data(t.replace(i,o),a.replace(i,o))})},r=t.eq(n);a(r[0]),r.find("*").each(function(){a(this)})},c=function(t,n,i,o,a,r){var c=new RegExp(l(i.name_prefix+"["+a+"]"),"g"),s=i.name_prefix+"["+r+"]";i.children&&e.each(i.children,function(e,n){var i=t.find(n.selector).eq(o),a=i.data("collection-settings");a&&(a.name_prefix=a.name_prefix.replace(c,s),i.data("collection-settings",a))}),d(n,o,c,s),c=new RegExp(l(t.attr("id")+"_"+a),"g"),s=t.attr("id")+"_"+r,i.children&&e.each(i.children,function(e,n){var i=t.find(n.selector).eq(o),a=i.data("collection-settings");a&&(a.elements_parent_selector=a.elements_parent_selector.replace(c,s),a.elements_selector=a.elements_selector.replace(c,s),a.prefix=a.prefix.replace(c,s),i.data("collection-settings",a))}),d(n,o,c,s)},s=function(e,t,n,i){var o=e.data("collection-settings");return o.position_field_selector||o.preserve_names||(c(e,t,o,n,n,"__swap__"),c(e,t,o,i,i,n),c(e,t,o,n,"__swap__",i)),t.eq(n).insertBefore(t.eq(i)),i>n?t.eq(i).insertBefore(t.eq(n)):t.eq(i).insertAfter(t.eq(n)),e.find(o.elements_selector)},f=function(e,t,n,i,o){for(var a=i+1;a<=o;a++)t=s(e,t,a,a-1);return e.find(n.elements_selector)},_=function(e,t,n,i,o){for(var a=i-1;a>=o;a--)t=s(e,t,a,a+1);return e.find(n.elements_selector)},p=function(e,t,n,i){for(var o=i+1;o<t.length;o++)t=s(e,t,o-1,o);return e.find(n.elements_selector)},u=function(t,n,o,a){var r=e(n.elements_parent_selector),l=0===r.find("."+n.prefix+"-tmp").length,d=t.find(n.elements_selector);if(n.allow_add&&l&&(r.append('<span class="'+n.prefix+'-tmp"></span>'),n.add&&r.append(e(n.add).addClass(n.prefix+"-action "+n.prefix+"-rescue-add").data("collection",t.attr("id")))),o){t.data("collection-offset",d.length);for(var c=e(n.container),s=t.find("."+n.prefix+"-add, ."+n.prefix+"-rescue-add, ."+n.prefix+"-duplicate").first(),f=0;d.length<n.init_with_n_elements;){f++;var _=d.length>0?d.last():void 0,p=d.length-1;if(d=m(c,s,t,n,d,_,p,!1),f>n.init_with_n_elements){console.error("Infinite loop, element selector ("+n.elements_selector+") not found !");break}}t.data("collection-offset",d.length)}if(d.each(function(r){var l=e(this);o&&l.data("index",r);var c=l.find("."+n.prefix+"-actions").addBack().filter("."+n.prefix+"-actions");0===c.length&&(c=e("<"+n.action_container_tag+' class="'+n.prefix+'-actions"></'+n.action_container_tag+">"),l.append(c));var s=0;"remove"===a&&n.fade_out&&(s=1);var f=[{enabled:n.allow_remove,selector:n.prefix+"-remove",html:n.remove,condition:d.length-s>n.min},{enabled:n.allow_up,selector:n.prefix+"-up",html:n.up,condition:d.length-s>1&&d.index(l)-s>0},{enabled:n.allow_down,selector:n.prefix+"-down",html:n.down,condition:d.length-s>1&&d.index(l)!==d.length-1},{enabled:n.allow_add&&!n.add_at_the_end&&!n.custom_add_location,selector:n.prefix+"-add",html:n.add,condition:d.length-s<n.max},{enabled:n.allow_duplicate,selector:n.prefix+"-duplicate",html:n.duplicate,condition:d.length-s<n.max}];e.each(f,function(o,a){if(a.enabled){var d=l.find("."+a.selector);0===d.length&&a.html&&(d=e(a.html).appendTo(c).addClass(a.selector)),a.condition?(d.removeClass(n.prefix+"-action-disabled"),n.hide_useless_buttons&&d.css("display","")):(d.addClass(n.prefix+"-action-disabled"),n.hide_useless_buttons&&d.css("display","none")),d.addClass(n.prefix+"-action").data("collection",t.attr("id")).data("element",i(t.attr("id")+"_"+r,l))}else l.find("."+a.selector).css("display","none")})}),n.allow_add){var u=0;"remove"===a&&n.fade_out&&(u=1);var h=t.find("."+n.prefix+"-rescue-add").css("display","").removeClass(n.prefix+"-action-disabled"),v=t.find("."+n.prefix+"-add");!n.add_at_the_end&&v.length>u||n.custom_add_location?h.css("display","none"):"remove"===a&&n.fade_out&&(h.css("display","none"),h.fadeIn("fast")),d.length-u>=n.max&&(h.addClass(n.prefix+"-action-disabled"),n.hide_useless_buttons&&t.find("."+n.prefix+"-add, ."+n.prefix+"-rescue-add, ."+n.prefix+"-duplicate").css("display","none"))}},h=function(t,n,i){i.children&&e.each(i.children,function(e,i){if(!i.selector)return console.log("jquery.collection.js: given collection "+t.attr("id")+" has children collections, but children's root selector is undefined."),!0;null!==n?n.find(i.selector).collection(i):t.find(i.selector).collection(i)})},m=function(t,n,i,d,c,s,f,_){if(c.length<d.max&&(_&&r(d.before_duplicate(i,s))||r(d.before_add(i,s)))){var m=i.data("prototype"),v=i.data("collection-offset");i.data("collection-offset",v+1),-1===f&&(f=c.length-1);var j=new RegExp(l(d.prototype_name),"g"),q=v;d.preserve_names&&(void 0===(q=i.data("collection-free-key"))&&(q=b(d,c)),i.data("collection-free-key",q+1));var C=e(m.replace(j,q)).data("index",v);y(d,C);var k=e(d.elements_parent_selector).find("> ."+d.prefix+"-tmp");e(C).find("[id]").first().attr("id");if(_){var E=c.eq(f);!function(t){e(t).find(":input").each(function(e,t){a(t,o(t),!0)})}(E);var B=e("<div/>").append(E.clone()).html(),Q=d.preserve_names||d.position_field_selector?E.data("index"):f,R=d.preserve_names?w(d,E):Q,A=function(e,t,n,i,o,a,r){var d=new RegExp(l(t.name_prefix+"["+a+"]"),"g"),c=t.name_prefix+"["+r+"]";return n=n.replace(d,c),d=new RegExp(l(e.attr("id")+"_"+i),"g"),c=e.attr("id")+"_"+o,n=n.replace(d,c)}(i,d,B,Q,v,R,q);C=e("<div/>").html(A).contents().data("index",v),d.fade_in&&C.hide(),k.before(C).find(d.prefix+"-actions").remove()}else d.fade_in&&C.hide(),k.before(C);c=i.find(d.elements_selector);var D=C.find("."+d.prefix+"-add, ."+d.prefix+"-duplicate");D.length>0&&D.addClass(d.prefix+"-action").data("collection",i.attr("id")),d.add_at_the_end||f+1===v?u(i,d,!1):c=x(i,d,c,C,v,f+1),h(i,C,d),(_&&!r(d.after_duplicate(i,C))||!r(d.after_add(i,C)))&&(-1!==f&&(c=p(i,c,d,f+1)),C.remove())}if(void 0!==C&&d.fade_in)C.fadeIn("fast",function(){d.position_field_selector&&g(d,c)});else if(d.position_field_selector)return g(d,c);return c},v=function(t,n,i,o,a){if(i.length>n.min&&r(n.before_remove(t,o))){var l=function(){var l=o;n.preserve_names||(l=(i=p(t,i,n,a)).last());var d=l.clone({withDataAndEvents:!0}).show();(l.remove(),r(n.after_remove(t,d)))||(e(n.elements_parent_selector).find("> ."+n.prefix+"-tmp").before(d),i=t.find(n.elements_selector),i=function(e,t,n,i){for(var o=t.length-2;o>i;o--)t=s(e,t,o+1,o);return e.find(n.elements_selector)}(t,i,n,a-1));n.position_field_selector&&g(n,i)};n.fade_out?o.fadeOut("fast",function(){l()}):l()}return i},x=function(e,t,n,i,o,a){return 1===Math.abs(a-o)?(n=s(e,n,o,a),r(a-o>0?t.after_up(e,i):t.after_down(e,i))||(n=s(e,n,a,o))):o<a?(n=f(e,n,t,o,a),r(a-o>0?t.after_up(e,i):t.after_down(e,i))||(n=_(e,n,t,a,o))):(n=_(e,n,t,o,a),r(a-o>0?t.after_up(e,i):t.after_down(e,i))||(n=f(e,n,t,a,o))),u(e,t,!1),t.position_field_selector?g(t,n):n},g=function(t,n){return e(n).each(function(){var i=e(this);a(i.find(t.position_field_selector),n.index(i))}),n},w=function(e,t){return t.find(':input[name^="'+e.name_prefix+'["]').attr("name").slice(e.name_prefix.length+1).split("]",1)[0]},b=function(t,n){var i=0;return n.each(function(){var n=w(t,e(this));/^0|[1-9]\d*$/.test(n)&&n>=i&&(i=Number(n)+1)}),i},y=function(t,n){e.each(["-action","-action-disabled","-actions","-add","-down","-duplicate","-remove","-rescue-add","-tmp","-up"],function(){var i=this;n.each(function(){var n=e(this);n.hasClass(t.user_prefix+i)&&n.addClass(t.prefix+i),n.find("*").each(function(){var n=e(this);n.hasClass(t.user_prefix+i)&&n.addClass(t.prefix+i)})})})},j=e(this);return 0===j.length?(console.log("jquery.collection.js: given collection selector does not exist."),!1):(j.each(function(){var l=e.extend(!0,{},n,t);if(0===e(l.container).length)return console.log("jquery.collection.js: a container should exist to handle events (basically, a <body> tag)."),!1;var d,c,f=e(this);if(void 0!==f.data("collection")){var _=e("#"+f.data("collection"));if(0===_.length)return console.log("jquery.collection.js: given collection id does not exist."),!0}else _=f;if(_=e(_),l.elements_parent_selector=l.elements_parent_selector.replace("%id%","#"+i("",_)),!l.elements_parent_selector&&(l.elements_parent_selector="#"+i("",_),0===e(l.elements_parent_selector).length))return console.log("jquery.collection.js: given elements parent selector does not return any object."),!0;if(l.user_prefix=l.prefix,l.prefix=_.attr("id")+"-"+l.user_prefix,y(l,_),l.allow_add||(l.allow_duplicate=!1,l.add_at_the_end=!1),l.init_with_n_elements>l.max&&(l.init_with_n_elements=l.max),l.min&&(!l.init_with_n_elements||l.init_with_n_elements<l.min)&&(l.init_with_n_elements=l.min),!l.action_container_tag)return console.log("jquery.collection.js: action_container_tag needs to be set."),!0;if(l.before_init(_),null===_.data("prototype"))return console.log("jquery.collection.js: given collection field has no prototype, check that your field has the prototype option set to true."),!0;if(void 0!==_.data("prototype-name")&&(l.prototype_name=_.data("prototype-name")),void 0!==_.data("allow-add")&&(l.allow_add=_.data("allow-add"),l.allow_duplicate=!!_.data("allow-add")&&l.allow_duplicate),void 0!==_.data("allow-remove")&&(l.allow_remove=_.data("allow-remove")),void 0!==_.data("name-prefix")&&(l.name_prefix=_.data("name-prefix")),!l.name_prefix)return console.log("jquery.collection.js: the prefix used in descendant field names is mandatory, you can set it using 2 ways:"),console.log("jquery.collection.js: - use the form theme given with this plugin source"),console.log("jquery.collection.js: - set name_prefix option to  '{{ formView.myCollectionField.vars.full_name }}'"),!0;(l.preserve_names&&(l.allow_up=!1,l.allow_down=!1,l.drag_drop=!1,l.add_at_the_end=!0),void 0!==jQuery.ui&&void 0!==jQuery.ui.sortable&&_.data("sortable")&&_.sortable("disable"),l.drag_drop&&l.allow_up&&l.allow_down)&&(void 0===jQuery.ui||void 0===jQuery.ui.sortable?l.drag_drop=!1:_.sortable(e.extend(!0,{},{start:function(t,n){var i=_.find(l.elements_selector),o=n.item,a=e(this);r(l.drag_drop_start(t,n,i,o))?(n.placeholder.height(n.item.height()),n.placeholder.width(n.item.width()),d=i.index(o)):a.sortable("cancel")},update:function(t,n){var i=_.find(l.elements_selector),o=n.item;e(this).sortable("cancel"),!1!==l.drag_drop_update(t,n,i,o)&&r(c-d>0?l.before_up(_,o):l.before_down(_,o))&&(c=i.index(o),i=_.find(l.elements_selector),x(_,l,i,o,d,c))}},l.drag_drop_options)));_.data("collection-settings",l);var p=e(l.container);if(p.off("click","."+l.prefix+"-action").on("click","."+l.prefix+"-action",function(t){var n,i,o=e(this);if(void 0===(i=(n=e("#"+o.data("collection"))).data("collection-settings"))&&void 0===(i=(n=e("#"+o.data("collection")).find("."+o.data("collection")+"-collection")).data("collection-settings")))throw"Can't find collection: "+o.data("collection");var a=n.find(i.elements_selector),l=o.data("element")?e("#"+o.data("element")):void 0,d=l&&l.length?a.index(l):-1,c=null,f=o.is("."+i.prefix+"-duplicate");(o.is("."+i.prefix+"-add")||o.is("."+i.prefix+"-rescue-add")||f)&&i.allow_add&&(c="add",a=m(p,o,n,i,a,l,d,f)),o.is("."+i.prefix+"-remove")&&i.allow_remove&&(c="remove",a=v(n,i,a,l,d)),o.is("."+i.prefix+"-up")&&i.allow_up&&(c="up",a=function(e,t,n,i,o){return 0!==o&&r(t.before_up(e,i))&&(n=s(e,n,o,o-1),r(t.after_up(e,i))||(n=s(e,n,o-1,o))),t.position_field_selector?g(t,n):n}(n,i,a,l,d)),o.is("."+i.prefix+"-down")&&i.allow_down&&(c="down",a=function(e,t,n,i,o){return o!==n.length-1&&r(t.before_down(e,i))&&(n=s(e,n,o,o+1),r(t.after_down(e,n))||(n=s(e,n,o+1,o))),t.position_field_selector?g(t,n):n}(n,i,a,l,d)),u(n,i,!1,c),t.preventDefault()}),u(_,l,!0),h(_,null,l),l.position_field_selector){var w=[],b=_.find(l.elements_selector);b.each(function(t){var n=e(this);w.push({position:parseFloat(o(n.find(l.position_field_selector))),element:n})});w.sort(function(e,t){return e.position<t.position?-1:e.position>t.position?1:0}),e.each(w,function(t,n){var i=[];e(b).each(function(t){i.push(e(this).attr("id"))});var o=n.element,r=e.inArray(o.attr("id"),i);t!==r&&(b=x(_,l,b,o,r,t),a(o.find(l.position_field_selector),b.index(o)))})}l.after_init(_)}),!0)}}(jQuery);
